# POSTWORK 01
library(dplyr) # Cargar paquete

#Establecer directorio de trabajo

#Cargar archivo en vector
liga<-read.csv("LigaPrimeraDiv-2019-20.csv")
str(liga)

#Seleccionar columnas de interés
goles<-select(liga, FTHG:FTAG)

# A) Elaborar tablas de frecuencias relativas,

# 1) Obtener tabla de frecuencia absoluta
f.abs <- table(goles)

# 2) Obtener tabla de frecuencia relativa
(f.rel<- round(prop.table(f.abs, margin=NULL),3)) #Global

# 3) Agregar columna de totales marginales sobre frecuencia relativa
(tmarg.rel<- addmargins(f.rel)) 

# Estimar las siguientes probabilidades:

#3) Probabilidad Marginal
x<-c(0:6) # Establecer rango de valores para x - Goles en casa
y<-c(0:5) # Establecer rango de valores para y - Goles como visitante

(x.goal<-sample(x, 1, F)) # Generar un valor dentro del rango
(y.goal<-sample(y, 1, F))

#La probabilidad (marginal) de que el equipo en casa anote x goles (x = 0, 1, 2, ...)
tmarg.rel[x.goal+1, "Sum"] # Se suma uno por considerar fila 1 Goles cero
paste("La probabilidad marginal que un equipo en casa anote", 
      x.goal, "goles es", round(tmarg.rel[x.goal+1, "Sum"]*100,2), "%")

#La probabilidad (marginal) de que el equipo 
#que juega como visitante anote y goles (y = 0, 1, 2, ...)
tmarg.rel["Sum",y.goal+1]
paste("La probabilidad marginal que un equipo visitante anote", 
      y.goal, "goles es", round(tmarg.rel["Sum",y.goal+1]*100,2),"%")

#La probabilidad (conjunta) de que el equipo en casa anote x goles
#y el equipo visitante anote y goles (x = 0, 1, 2, ..., y = 0, 1, 2, ...)

#4) Probabilidad conjunta
tmarg.rel[x.goal+1,y.goal+1] #Recuperar la coordenada producida

paste("La probabilidad conjunta que un equipo en casa anote", 
      x.goal, "goles y el visitante meta", y.goal, 
      "es", round(tmarg.rel[x.goal+1,y.goal+1]*100,2), "%")
tmarg.rel
write.csv(tmarg.rel, file= "TablaProbabilidad.csv")

############################################################################

# POSTWORK 02

install.packages("lubridate") # Cargar paquete
install.packages("tidyverse")
library(dplyr)
library(lubridate)
library(tidyverse)

#Cargar archivos en vector
liga2019<-read.csv("LigaPrimeraDiv-2019-20.csv") #Archivo con columna extra
liga2018<-read.csv("LigaPrimeraDiv-2018-19.csv")
liga2017 <-read.csv("LigaPrimeraDiv-17-18.csv") # Archivo con formato de año diferente

# 1) Revisa la estructura de los data frames usando las funciones: str, head, View y summary

str(liga2019)
head(liga2019)
summary(liga2019)
View(liga2019)

str(liga2018)
head(liga2018)
summary(liga2018)
View(liga2018)

str(liga2017)
head(liga2017)
summary(liga2017)
View(liga2017)

# 2) Con la función select del paquete dplyr, selecciona únicamente las columnas:
# Date, HomeTeam, AwayTeam, FTHG, FTAG y FTR; 
# para cada uno de los data frames. (Hint: también puedes usar lapply).

liga2019<-liga2019[,-3] # Eliminar columna TIME
teams2019<- select (liga2019,Date:FTR)
teams2018<- select (liga2018,Date:FTR)
teams2017<- select (liga2017,Date:FTR)

teams2017$Date <-sub("/17","/2017",teams2017$Date) # Corregir formato año
teams2017$Date <-sub("/18","/2018",teams2017$Date)

# 3) Asegúrate de que los elementos de las columnas correspondientes de los nuevos data frames 
#sean del mismo tipo 
#Hint 1: usa as.Date y mutate para arreglar las fecha 
str(teams2019)

#Con ayuda de la función rbind, forma un único data frame que contenga
# las seis columnas mencionadas en el punto 3 (
#Hint 2: la función do.call podría ser utilizada).

firstmerge<-rbind(teams2017,teams2018)
teams1719<-rbind(firstmerge, teams2019)

teams1719<-mutate(teams1719, Date=as.Date(Date,"%d/%m/%Y"))
teams1719
str(teams1719)
write.csv(teams1719, file= "Goals17-19.csv")

###############################################################################

# POSTWORK 03   Objetivo
# Realizar descarga de archivos desde internet
# Generar nuevos data frames
# Visualizar probabilidades estimadas con la ayuda de gráficas

library(dplyr)
library(ggplot2)
library(plotly)
library(scales)

# Desarrollo
# Graficar las probabilidades (estimadas) marginales y conjuntas 
#para el número de goles que anotan en un partido el equipo de casa o visitante.

prob.goal<-read.csv("C:/Users/avila/Documents/Files-R/PWS02/Goals17-19.csv")
str(prob.goal)

goles.new<-select(prob.goal, FTHG:FTAG)# Seleccionar columnas de goles

# 1) Obtener tabla de frecuencia absoluta
f.abs <- table(goles.new)
# 2) Obtener tabla de frecuencia relativa
(f.rel<- round(prop.table(f.abs, margin=NULL),3)) #Global
# 3) Agregar columna de totales marginales sobre frecuencia relativa
(tmarg.rel<- addmargins(f.rel)) 

write.csv(tmarg.rel, file= "C:/Users/avila/Documents/Files-R/PWS01/ProbRel.17-19.csv") 

# Con el último data frame obtenido en el postwork de la sesión 2, 
#elabora tablas de frecuencias relativas para estimar las sig. probabilidades:
pr.goal<-read.csv("C:/Users/avila/Documents/Files-R/PWS01/ProbRel.Head.csv")
names(pr.goal)

# La probabilidad (marginal) de que el equipo que juega en casa anote x goles 
#(x=0,1,2,)
x<-c(0:8) # Establecer rango de valores para x - Goles en casa
y<-c(0:6) # Establecer rango de valores para y - Goles como visitante

(x.goal<-sample(x, 1, F)) # Generar un valor dentro del rango
(y.goal<-sample(y, 1, F))

pr.goal[x.goal+1, "HSum"]
paste("La probabilidad marginal que un equipo en casa anote", 
      x.goal, "goles es", round(pr.goal[x.goal+1, "HSum"]*100,2), "%")

# La probabilidad (marginal) de que el equipo visitante anote y goles 
#(y=0,1,2,)
pr.goal["ASum",y.goal+1]
paste("La probabilidad marginal que un equipo visitante anote", 
      y.goal, "goles es", round(pr.goal["ASum",y.goal+1]*100,2),"%")

# La probabilidad (conjunta) de que el equipo que juega en casa anote x goles 
#y el equipo que juega como visitante anote y goles (x=0,1,2,, y=0,1,2,)
pr.goal[x.goal+1,y.goal+1] #Recuperar la coordenada producida

paste("La probabilidad conjunta que un equipo en casa anote", 
      x.goal, "goles y el visitante meta", y.goal, 
      "es", round(pr.goal[x.goal+1,y.goal+1]*100,2), "%")
pr.goal
